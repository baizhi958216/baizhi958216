# xorg 双显卡配置

# 摘要

某二次元笔记本没有独显直连，也就是说两块屏幕在用的核显，type-c 连的独显没显示  
一定是我没有熟读并背诵 ArchWiki。(逃

# 准备

先打上驱动

```bash
sudo pacman -S nvidia nvidia-utils lib32-nvidia-utils
```

先看看有没有识别到

```bash
lspci -k | grep -A 2 -E "(VGA|3D)"
```

```bash
[baizhi958216@TianXuan ~]$ lspci -k | grep -A 2 -E "(VGA|3D)"
01:00.0 VGA compatible controller: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] (rev a1)
        Subsystem: ASUSTeK Computer Inc. Device 16a2
        Kernel driver in use: nvidia
--
06:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cezanne (rev c5)
        Subsystem: ASUSTeK Computer Inc. Device 16a2
        Kernel driver in use: amdgpu
[baizhi958216@TianXuan ~]$
```

# 配置 Xorg

根据[ArchWiki](https://wiki.archlinux.org/title/NVIDIA#Installation)的描述，可以用`nvidia-xconfig`自动化配置

```bash
sudo nvidia-xconfig
```

```bash
[baizhi958216@TianXuan ~]$ sudo nvidia-xconfig
[sudo] baizhi958216 的密码：

WARNING: Unable to locate/open X configuration file.

New X configuration file written to '/etc/X11/xorg.conf'

[baizhi958216@TianXuan ~]$
```

于是在/etc/X11 生成了`xorg.conf`这个配置文件

```
 nvidia-xconfig: X configuration file generated by nvidia-xconfig
# nvidia-xconfig:  version 515.43.04

Section "ServerLayout"
    Identifier     "Layout0"
    Screen      0  "Screen0"
    InputDevice    "Keyboard0" "CoreKeyboard"
    InputDevice    "Mouse0" "CorePointer"
EndSection

Section "Files"
EndSection

Section "InputDevice"
    # generated from default
    Identifier     "Mouse0"
    Driver         "mouse"
    Option         "Protocol" "auto"
    Option         "Device" "/dev/psaux"
    Option         "Emulate3Buttons" "no"
    Option         "ZAxisMapping" "4 5"
EndSection

Section "InputDevice"
    # generated from default
    Identifier     "Keyboard0"
    Driver         "kbd"
EndSection

Section "Monitor"
    Identifier     "Monitor0"
    VendorName     "Unknown"
    ModelName      "Unknown"
    Option         "DPMS"
EndSection

Section "Device"
    Identifier     "Device0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BusID          "PCI:1:0:0"
EndSection

Section "Screen"
    Identifier     "Screen0"
    Device         "Device0"
    Monitor        "Monitor0"
    DefaultDepth    24
    SubSection     "Display"
        Depth       24
    EndSubSection
EndSection
```

重点来了，配置文件把英伟达显卡总线`BusID "PCI:1:0:0"`加上了

```
Section "Device"
    Identifier     "Device0"
    Driver         "nvidia"
    VendorName     "NVIDIA Corporation"
    BusID          "PCI:1:0:0"
EndSection
```

如果现在重新登录将会得到两张黑着的屏幕，要在`/etc/X11/xorg.conf.d/20-amdgpu.conf`把 AMD 的加上

```
Section "Device"
     Identifier "AMD"
     Driver "amdgpu"
EndSection
```

然后重新登录

# 开启屏幕

进入`kde系统设置-显卡与显示器-显示器配置`，把另一快屏幕勾上，点击应用。
![52Lg3.png](https://s1.328888.xyz/2022/05/30/52Lg3.png)
最终三块屏幕连在一起，配置一下刷新率分辨率位置摆放就可以用了。
![52rQT.png](https://s1.328888.xyz/2022/05/30/52rQT.png)
